{
  "openapi": "3.0.0",
  "paths": {
    "/": {
      "get": {
        "operationId": "AppController_getHello",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Health / welcome message",
        "tags": [
          "root"
        ]
      }
    },
    "/health": {
      "get": {
        "operationId": "HealthController_check",
        "parameters": [],
        "responses": {
          "200": {
            "description": "The Health Check is successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "info": {
                      "type": "object",
                      "example": {
                        "database": {
                          "status": "up"
                        }
                      },
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      },
                      "nullable": true
                    },
                    "error": {
                      "type": "object",
                      "example": {},
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      },
                      "nullable": true
                    },
                    "details": {
                      "type": "object",
                      "example": {
                        "database": {
                          "status": "up"
                        }
                      },
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      }
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "The Health Check is not successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "error"
                    },
                    "info": {
                      "type": "object",
                      "example": {
                        "database": {
                          "status": "up"
                        }
                      },
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      },
                      "nullable": true
                    },
                    "error": {
                      "type": "object",
                      "example": {
                        "redis": {
                          "status": "down",
                          "message": "Could not connect"
                        }
                      },
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      },
                      "nullable": true
                    },
                    "details": {
                      "type": "object",
                      "example": {
                        "database": {
                          "status": "up"
                        },
                        "redis": {
                          "status": "down",
                          "message": "Could not connect"
                        }
                      },
                      "additionalProperties": {
                        "type": "object",
                        "required": [
                          "status"
                        ],
                        "properties": {
                          "status": {
                            "type": "string"
                          }
                        },
                        "additionalProperties": true
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Kiểm tra DB và dịch vụ",
        "tags": [
          "health"
        ]
      }
    },
    "/auth/register": {
      "post": {
        "operationId": "AuthController_register",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Đăng ký thành công"
          },
          "400": {
            "description": "Email đã tồn tại hoặc dữ liệu không hợp lệ"
          }
        },
        "summary": "Đăng ký tài khoản mới",
        "tags": [
          "auth"
        ]
      }
    },
    "/auth/login": {
      "post": {
        "operationId": "AuthController_login",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Đăng nhập thành công"
          },
          "401": {
            "description": "Sai email hoặc mật khẩu"
          }
        },
        "summary": "Đăng nhập, trả access token + refresh token",
        "tags": [
          "auth"
        ]
      }
    },
    "/auth/refresh": {
      "post": {
        "operationId": "AuthController_refresh",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefreshTokenDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Refresh thành công"
          },
          "401": {
            "description": "Refresh token không hợp lệ"
          }
        },
        "summary": "Lấy access token mới từ refresh token",
        "tags": [
          "auth"
        ]
      }
    },
    "/users/me": {
      "get": {
        "operationId": "UsersController_getProfile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Thông tin user"
          },
          "401": {
            "description": "Chưa đăng nhập"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Lấy profile user hiện tại",
        "tags": [
          "users"
        ]
      },
      "patch": {
        "operationId": "UsersController_updateProfile",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProfileDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cập nhật thành công"
          },
          "401": {
            "description": "Chưa đăng nhập"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Cập nhật profile user hiện tại",
        "tags": [
          "users"
        ]
      }
    },
    "/courses": {
      "get": {
        "operationId": "CoursesController_listCourses",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Danh sách khóa học đã publish (public)",
        "tags": [
          "courses"
        ]
      },
      "post": {
        "operationId": "CoursesController_createCourse",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCourseDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": ""
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Teacher tạo khóa học mới (mặc định DRAFT)",
        "tags": [
          "courses"
        ]
      }
    },
    "/courses/{id}": {
      "get": {
        "operationId": "CoursesController_getCourse",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          },
          "404": {
            "description": "Course not found"
          }
        },
        "summary": "Chi tiết khóa học (kèm danh sách lesson)",
        "tags": [
          "courses"
        ]
      },
      "patch": {
        "operationId": "CoursesController_updateCourse",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCourseDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": ""
          },
          "404": {
            "description": "Course not found or not owned"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Teacher cập nhật khóa học của mình",
        "tags": [
          "courses"
        ]
      },
      "delete": {
        "operationId": "CoursesController_deleteCourse",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": ""
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Teacher xóa mềm khóa học của mình",
        "tags": [
          "courses"
        ]
      }
    },
    "/courses/{id}/publish": {
      "patch": {
        "operationId": "CoursesController_publishCourse",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Teacher publish khóa học của mình",
        "tags": [
          "courses"
        ]
      }
    },
    "/courses/{id}/unpublish": {
      "patch": {
        "operationId": "CoursesController_unpublishCourse",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Teacher unpublish khóa học của mình",
        "tags": [
          "courses"
        ]
      }
    },
    "/enrollments": {
      "post": {
        "operationId": "EnrollmentsController_enroll",
        "parameters": [],
        "responses": {
          "201": {
            "description": ""
          }
        },
        "summary": "Ghi danh vào khóa học (body: courseId)",
        "tags": [
          "enrollments"
        ]
      }
    },
    "/quizzes": {
      "get": {
        "operationId": "QuizzesController_listQuizzes",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "summary": "Danh sách quiz (filter theo lesson/course)",
        "tags": [
          "quizzes"
        ]
      }
    },
    "/ai/generate-quiz": {
      "post": {
        "operationId": "AiController_generateQuiz",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateQuizDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Job đã vào queue",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QueuedResponseDto"
                }
              }
            }
          }
        },
        "summary": "Sinh quiz từ nội dung bài học (async queue)",
        "tags": [
          "ai"
        ]
      }
    },
    "/ai/grade-essay": {
      "post": {
        "operationId": "AiController_gradeEssay",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GradeEssayDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Job đã vào queue",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QueuedResponseDto"
                }
              }
            }
          }
        },
        "summary": "Chấm bài luận bằng AI (async queue)",
        "tags": [
          "ai"
        ]
      }
    }
  },
  "info": {
    "title": "AI-LMS API",
    "description": "AI Powered Learning Management System API",
    "version": "1.0",
    "contact": {}
  },
  "tags": [
    {
      "name": "auth",
      "description": "Đăng ký, đăng nhập, refresh token"
    },
    {
      "name": "users",
      "description": "Quản lý user và profile"
    },
    {
      "name": "courses",
      "description": "Khóa học và bài học"
    },
    {
      "name": "enrollments",
      "description": "Ghi danh khóa học"
    },
    {
      "name": "quizzes",
      "description": "Quiz và nộp bài"
    },
    {
      "name": "ai",
      "description": "Tính năng AI: generate quiz, grade essay"
    },
    {
      "name": "health",
      "description": "Health check"
    },
    {
      "name": "root",
      "description": "API root"
    }
  ],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http"
      }
    },
    "schemas": {
      "RegisterDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "student@example.com"
          },
          "password": {
            "type": "string",
            "example": "password123",
            "description": "Tối thiểu 6 ký tự"
          },
          "fullName": {
            "type": "string",
            "example": "Nguyễn Văn A"
          },
          "role": {
            "type": "string",
            "enum": [
              "ADMIN",
              "TEACHER",
              "STUDENT"
            ],
            "default": "STUDENT"
          }
        },
        "required": [
          "email",
          "password",
          "fullName"
        ]
      },
      "LoginDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "student@example.com",
            "description": "Email đăng nhập"
          },
          "password": {
            "type": "string",
            "example": "password123",
            "description": "Mật khẩu (tối thiểu 6 ký tự)"
          }
        },
        "required": [
          "email",
          "password"
        ]
      },
      "RefreshTokenDto": {
        "type": "object",
        "properties": {
          "refreshToken": {
            "type": "string",
            "description": "Refresh token đã nhận khi đăng nhập/đăng ký"
          }
        },
        "required": [
          "refreshToken"
        ]
      },
      "UpdateProfileDto": {
        "type": "object",
        "properties": {
          "fullName": {
            "type": "string",
            "example": "Nguyễn Văn B"
          },
          "avatarUrl": {
            "type": "string",
            "example": "https://example.com/avatar.png",
            "description": "URL ảnh đại diện"
          }
        }
      },
      "CreateCourseDto": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string",
            "example": "NestJS for Beginners"
          },
          "description": {
            "type": "string",
            "example": "Học NestJS từ cơ bản đến nâng cao"
          },
          "level": {
            "type": "string",
            "enum": [
              "BEGINNER",
              "INTERMEDIATE",
              "ADVANCED"
            ],
            "example": "BEGINNER"
          },
          "price": {
            "type": "number",
            "example": 49.99
          },
          "thumbnailUrl": {
            "type": "string",
            "example": "https://example.com/course-thumbnail.png"
          }
        },
        "required": [
          "title",
          "description",
          "level",
          "price"
        ]
      },
      "UpdateCourseDto": {
        "type": "object",
        "properties": {
          "title": {
            "type": "string",
            "example": "NestJS for Beginners"
          },
          "description": {
            "type": "string",
            "example": "Học NestJS từ cơ bản đến nâng cao"
          },
          "level": {
            "type": "string",
            "enum": [
              "BEGINNER",
              "INTERMEDIATE",
              "ADVANCED"
            ],
            "example": "BEGINNER"
          },
          "price": {
            "type": "number",
            "example": 49.99
          },
          "thumbnailUrl": {
            "type": "string",
            "example": "https://example.com/course-thumbnail.png"
          }
        }
      },
      "GenerateQuizDto": {
        "type": "object",
        "properties": {
          "lessonContent": {
            "type": "string",
            "description": "Nội dung bài học dùng để sinh câu hỏi"
          },
          "lessonTitle": {
            "type": "string",
            "description": "Tiêu đề bài học"
          },
          "language": {
            "type": "string",
            "default": "vi"
          },
          "questionCount": {
            "type": "number",
            "default": 5,
            "description": "Số câu hỏi cần sinh"
          }
        },
        "required": [
          "lessonContent"
        ]
      },
      "QueuedResponseDto": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "queued",
            "description": "Job đã được đưa vào queue xử lý bất đồng bộ"
          }
        },
        "required": [
          "status"
        ]
      },
      "GradeEssayDto": {
        "type": "object",
        "properties": {
          "question": {
            "type": "string",
            "description": "Nội dung câu hỏi"
          },
          "answer": {
            "type": "string",
            "description": "Câu trả lời của học viên"
          },
          "rubric": {
            "type": "string",
            "description": "Tiêu chí chấm (rubric)"
          },
          "maxScore": {
            "type": "number",
            "default": 10
          },
          "language": {
            "type": "string",
            "default": "vi"
          }
        },
        "required": [
          "question",
          "answer"
        ]
      }
    }
  }
}